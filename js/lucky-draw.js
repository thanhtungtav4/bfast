var gdnlWheel={totalGift:6,giftData:0,theWheel:null,background:null,backgroundImg:null,audio:null,audioSrc:null,wheelPower:0,wheelSpinning:!1,_init:function(){var e=this;this.theWheel=new Winwheel({numSegments:e.totalGift,outerRadius:180,drawText:!0,textFontSize:0,textOrientation:"curved",textDirection:"reversed",textAlignment:"outer",textMargin:5,textFontFamily:"monospace",textStrokeStyle:"black",textLineWidth:2,textFillStyle:"white",responsive:!0,drawMode:"image",segments:e.giftData,animation:{type:"spinToStop",duration:20,spins:15,callbackFinished:this.winAnimation,callbackSound:this.playSound,soundTrigger:"pin"},pins:{number:e.totalGift,fillStyle:"silver",outerRadius:4,responsive:!0}}),this.background=new Image,this.background.onload=function(){e.theWheel.wheelImage=e.background,e.theWheel.draw()},this.background.src=this.backgroundImg},_initHome:function(){var e=this;this.theWheel=new Winwheel({numSegments:6,outerRadius:200,drawText:!0,textFontSize:20,textOrientation:"curved",textDirection:"reversed",textAlignment:"outer",textMargin:5,textFontFamily:"monospace",textStrokeStyle:"black",textLineWidth:2,textFillStyle:"white",responsive:!0,drawMode:"image",segments:[{fillStyle:"#eae56f"},{fillStyle:"#89f26e"},{fillStyle:"#7de6ef"},{fillStyle:"#e7706f"},{fillStyle:"#eae56f"},{fillStyle:"#89f26e"}],animation:{type:"spinToStop",duration:20,spins:10,callbackFinished:this.winAnimationHome,callbackSound:this.playSound,soundTrigger:"pin"},pins:{number:6,fillStyle:"#e7706f",outerRadius:4,responsive:!0}}),this.background=new Image,this.background.onload=function(){e.theWheel.wheelImage=e.background,e.theWheel.draw()},this.background.src=this.backgroundImg},playSound:function(){audio.pause(),audio.currentTime=0,audio.play()},winAnimation:function(e){$("#show-result").modal(),$("#start-lucky").show(),gdnlWheel.resetWheel()},winAnimationHome:function(e){$("#note").modal(),gdnlWheel.resetWheel()},drawColourTriangle:function(){var e=gdnlWheel.theWheel.ctx;e.strokeStyle="navy",e.fillStyle="aqua",e.lineWidth=2,e.beginPath(),e.moveTo(390,174),e.lineTo(390,226),e.lineTo(360,200),e.lineTo(390,175),e.stroke(),e.fill()},startSpin:function(){0==this.wheelSpinning&&(this.theWheel.startAnimation(),this.wheelSpinning=!0)},resetWheel:function(){this.theWheel.stopAnimation(!1),this.theWheel.rotationAngle=0,this.theWheel.draw(),this.wheelSpinning=!1},playGame:function(){var i=this;0==this.wheelSpinning&&$.post(laroute.route("luckydraw.start"),function(t){if(!t.error)return $("#start-lucky").hide(),$("#game-result").html(t.result),$("#show-result").on("hide.bs.modal",function(){window.location.reload()}),i.startSpin(),void setTimeout(function(){var e=i.theWheel.getRandomForSegment(t.data);i.theWheel.animation.stopAngle=e,i.theWheel.startAnimation()},3e3);$("#popup-error").find("p").html(t.message),$("#popup-error").modal()})}},luckyDraw={run:function(){$("#popup-game").modal()},sendInvoice:function(){$("#popup-invoice").modal()},processSend:function(){var e=$("#frmInvoice");e.validate({ignore:"",rules:{invoice_no:"required",invoice_image:"required"},errorPlacement:function(e,t){"invoice_image"==t.attr("name")?$("#uploadfrmcheck").html(e):e.insertAfter(t)}}),e.valid()&&$.post(laroute.route("luckydraw.invoice"),e.serialize(),function(e){if(e.error)return $("#popup-error").find("p").html(e.message),void $("#popup-error").modal();$("#popup-invoice").modal("hide"),$("#popup-game").modal(),$("#popup-game").on("hide.bs.modal",function(){window.location.reload()})})},login:function(){$("#show-result").modal()},start:function(){gdnlWheel.playGame()}};$("#fileuploader").uploadFile({url:"https://sms.piotech.xyz/summer2019/upload.php",dragDrop:!1,maxFileCount:1,fileName:"myfile",showPreview:!0,previewHeight:80,previewWidth:"auto",uploadStr:"",deleteStr:"Xóa",abortStr:"Hủy",maxFileCountErrorStr:" không được phép. Số lượng file tối đa cho phép là:",dragDropStr:"<span class='text-drag'><b>Chọn tập tin hoặc kéo vào đây</b></span>",statusBarWidth:330,showDelete:!0,dragDrop:!0,headers:{"X-Auth-Token":token},onSubmit:function(){},onSuccess:function(e,t,i,n){t.error?(n.statusbar.remove(),$("#ul-err-log").html('<div class="ajax-file-upload-error">Lỗi: '+t.message+"</div>"),$("#fileUploadeds").html('<input type="hidden" name="invoice_image" value="">')):($("#fileUploadeds").html('<input type="hidden" name="invoice_image" value="'+t.data+'">'),$("#uploadfrmcheck").html(""))},onError:function(){$("#fileUploadeds").html('<input type="hidden" name="invoice_image" value="">')},onAbort:function(){$("#fileUploadeds").html('<input type="hidden" name="invoice_image" value="">')},deleteCallback:function(e,t){$("#fileUploadeds").html('<input type="hidden" name="invoice_image" value="">')}});